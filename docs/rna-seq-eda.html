<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 RNA-seq EDA | Tidy Ranges Tutorial</title>
  <meta name="description" content="<p>Basic examples of computing operations on genomic ranges using the
tidy data philosophy.</p>" />
  <meta name="generator" content="bookdown 0.32 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 RNA-seq EDA | Tidy Ranges Tutorial" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="<p>Basic examples of computing operations on genomic ranges using the
tidy data philosophy.</p>" />
  <meta name="github-repo" content="nullranges/tidy-ranges-tutorial" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 RNA-seq EDA | Tidy Ranges Tutorial" />
  
  <meta name="twitter:description" content="<p>Basic examples of computing operations on genomic ranges using the
tidy data philosophy.</p>" />
  

<meta name="author" content="nullranges devel team" />


<meta name="date" content="2023-05-09" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="gene-plots.html"/>
<link rel="next" href="many-models.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Tidy Ranges Tutorial</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About</a></li>
<li class="chapter" data-level="1" data-path="join-is-an-overlap.html"><a href="join-is-an-overlap.html"><i class="fa fa-check"></i><b>1</b> Join is an overlap</a></li>
<li class="chapter" data-level="2" data-path="compute-overlaps.html"><a href="compute-overlaps.html"><i class="fa fa-check"></i><b>2</b> Compute overlaps</a></li>
<li class="chapter" data-level="3" data-path="promoter-marks.html"><a href="promoter-marks.html"><i class="fa fa-check"></i><b>3</b> Promoter marks</a></li>
<li class="chapter" data-level="4" data-path="bootstrap-overlap.html"><a href="bootstrap-overlap.html"><i class="fa fa-check"></i><b>4</b> Bootstrap overlap</a></li>
<li class="chapter" data-level="5" data-path="snp-position-in-peaks.html"><a href="snp-position-in-peaks.html"><i class="fa fa-check"></i><b>5</b> SNP position in peaks</a></li>
<li class="chapter" data-level="6" data-path="gene-plots.html"><a href="gene-plots.html"><i class="fa fa-check"></i><b>6</b> Gene plots</a></li>
<li class="chapter" data-level="7" data-path="rna-seq-eda.html"><a href="rna-seq-eda.html"><i class="fa fa-check"></i><b>7</b> RNA-seq EDA</a></li>
<li class="chapter" data-level="8" data-path="many-models.html"><a href="many-models.html"><i class="fa fa-check"></i><b>8</b> Many models</a></li>
<li class="chapter" data-level="9" data-path="isoform-analysis.html"><a href="isoform-analysis.html"><i class="fa fa-check"></i><b>9</b> Isoform analysis</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Tidy Ranges Tutorial</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="rna-seq-eda" class="section level1 hasAnchor" number="7">
<h1><span class="header-section-number">Chapter 7</span> RNA-seq EDA<a href="rna-seq-eda.html#rna-seq-eda" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Objective: learn how to make basic EDA plots (plotting scaled counts)
of RNA-seq data using tidy-style verbs.</p>
<p>The <em>tidybulk</em> Bioconductor package and associated
<a href="https://stemangiola.github.io/tidytranscriptomics/post/tidy-transcriptomics-manifesto/">tidy transcriptomics</a>
ecosystem (tidySummarizedExperiment, tidySingleCell, tidyseurat, etc.)
provide a bridge between the <em>SummarizedExperiment</em>-style
representation of matrix data with attached metadata, to the
tidy-style representation of data (one row per observation).
For more details on the package, check out the
<a href="https://stemangiola.github.io/tidybulk/">tidybulk</a>
website, and the publication: <span class="citation"><a href="#ref-tidybulk" role="doc-biblioref">Mangiola et al.</a> (<a href="#ref-tidybulk" role="doc-biblioref">2021</a>)</span>.</p>
<p>Here we will briefly examine the difference between tidy manipulation
of these matrix-style objects compared to how these objects would be
manipulated in other Bioconductor workflows (e.g.¬†DESeq2, edgeR, or
limma workflows). As you will see, there are multiple ways to generate
the same or similar exploratory plots and analyses. we recommend to
consider which is more appropriate to your purpose. For package code,
you may prefer to have fewer dependencies, going with core
Bioconductor objects and packages. For scripting, the ‚Äúfluent‚Äù and
piped style of <em>tidybulk</em> may be preferable, and easier for others to
read and modify your code at a future date.</p>
<p>Here we just compare code for some basic tasks, scaling counts and
performing DE with DESeq2. However, note that <em>tidybulk</em> has
many functionalities implemented, including dimension reduction and
visualization (PCA, MDS, tSNE, UMAP), clustering, gene set testing,
cell type composition analysis and cell abundance testing, unwanted
variation modeling, imputation, etc.</p>
<p>Start by loading this RNA-seq dataset from the following paper:
<span class="citation"><a href="#ref-king_klose" role="doc-biblioref">King and Klose</a> (<a href="#ref-king_klose" role="doc-biblioref">2017</a>)</span> ‚ÄúThe pioneer factor OCT4 requires the chromatin
remodeller BRG1 to support gene regulatory element function in mouse
embryonic stem cells‚Äù <a href="https://doi.org/10.7554/eLife.22631" class="uri">https://doi.org/10.7554/eLife.22631</a>. The
experiment focused on OCT4 as it is a ‚Äúcore pluripotency transcription
factor‚Äù which ‚Äúoccupies sites that would otherwise be inaccessible and
is required to shape the occupancy of additional pluripotency
transcription factors.‚Äù</p>
<p>In this experiment, transcription in mouse embryonic stem cells (ESC)
was compared with and without OCT4. This was done using a conditional
mouse ESC line where treatment with a compound leads to loss of OCT4
expression. The experiment also involved the same approach to another
transcription factor BRG1, but we focus here on the OCT4 samples.</p>
<p>First we load the metadata about the samples:</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="rna-seq-eda.html#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(oct4)</span>
<span id="cb152-2"><a href="rna-seq-eda.html#cb152-2" aria-hidden="true" tabindex="-1"></a>dir <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="at">package=</span><span class="st">&quot;oct4&quot;</span>)</span>
<span id="cb152-3"><a href="rna-seq-eda.html#cb152-3" aria-hidden="true" tabindex="-1"></a>coldata <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">file.path</span>(dir,<span class="st">&quot;coldata.csv&quot;</span>))</span>
<span id="cb152-4"><a href="rna-seq-eda.html#cb152-4" aria-hidden="true" tabindex="-1"></a>coldata</span></code></pre></div>
<pre><code>##         names line condition
## 1  SRX2236945 OCT4     untrt
## 2  SRX2236946 OCT4     untrt
## 3  SRX2236947 OCT4     untrt
## 4  SRX2236948 OCT4       trt
## 5  SRX2236949 OCT4       trt
## 6  SRX2236950 OCT4       trt
## 7  SRX2236951 BRG1     untrt
## 8  SRX2236952 BRG1     untrt
## 9  SRX2236953 BRG1     untrt
## 10 SRX2236954 BRG1       trt
## 11 SRX2236955 BRG1       trt
## 12 SRX2236956 BRG1       trt</code></pre>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="rna-seq-eda.html#cb154-1" aria-hidden="true" tabindex="-1"></a>coldata<span class="sc">$</span>files <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dir, <span class="st">&quot;quants&quot;</span>, coldata<span class="sc">$</span>names, <span class="st">&quot;quant.sf.gz&quot;</span>)</span></code></pre></div>
<p>Read in the count data with <em>tximeta</em>, which automatically imports the
information about the gene provenance (which transcripts were used to
quantify the gene and isoform abundance). We then summarize the
quantification to the gene-level, and add the gene <code>SYMBOL</code>.</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="rna-seq-eda.html#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tximeta)</span>
<span id="cb155-2"><a href="rna-seq-eda.html#cb155-2" aria-hidden="true" tabindex="-1"></a>se <span class="ot">&lt;-</span> <span class="fu">tximeta</span>(coldata)</span>
<span id="cb155-3"><a href="rna-seq-eda.html#cb155-3" aria-hidden="true" tabindex="-1"></a>gse <span class="ot">&lt;-</span> <span class="fu">summarizeToGene</span>(se)</span>
<span id="cb155-4"><a href="rna-seq-eda.html#cb155-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(org.Mm.eg.db)</span>
<span id="cb155-5"><a href="rna-seq-eda.html#cb155-5" aria-hidden="true" tabindex="-1"></a>gse <span class="ot">&lt;-</span> <span class="fu">addIds</span>(gse, <span class="st">&quot;SYMBOL&quot;</span>)</span></code></pre></div>
<p>For this workflow, we don‚Äôt need the inferential replicates (about
uncertainty regarding the quantification), so we keep just the counts,
abundances (TPM), and gene lengths. We also manipulate the metadata a
little bit.</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="rna-seq-eda.html#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SummarizedExperiment)</span>
<span id="cb156-2"><a href="rna-seq-eda.html#cb156-2" aria-hidden="true" tabindex="-1"></a><span class="fu">assayNames</span>(gse)</span>
<span id="cb156-3"><a href="rna-seq-eda.html#cb156-3" aria-hidden="true" tabindex="-1"></a><span class="fu">assays</span>(gse) <span class="ot">&lt;-</span> <span class="fu">assays</span>(gse)[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span>
<span id="cb156-4"><a href="rna-seq-eda.html#cb156-4" aria-hidden="true" tabindex="-1"></a>gse<span class="sc">$</span>rep <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">4</span>)</span>
<span id="cb156-5"><a href="rna-seq-eda.html#cb156-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(gse) <span class="ot">&lt;-</span> <span class="fu">paste</span>(gse<span class="sc">$</span>line,gse<span class="sc">$</span>condition,gse<span class="sc">$</span>rep,<span class="at">sep=</span><span class="st">&quot;-&quot;</span>)</span>
<span id="cb156-6"><a href="rna-seq-eda.html#cb156-6" aria-hidden="true" tabindex="-1"></a><span class="fu">assay</span>(gse, <span class="st">&quot;counts&quot;</span>) <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">assay</span>(gse, <span class="st">&quot;counts&quot;</span>)) <span class="co"># for DE consistency</span></span>
<span id="cb156-7"><a href="rna-seq-eda.html#cb156-7" aria-hidden="true" tabindex="-1"></a><span class="co"># save for easy loading later</span></span>
<span id="cb156-8"><a href="rna-seq-eda.html#cb156-8" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(gse, <span class="at">file=</span><span class="st">&quot;data/oct4_obj.rda&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="rna-seq-eda.html#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SummarizedExperiment)</span>
<span id="cb157-2"><a href="rna-seq-eda.html#cb157-2" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;data/oct4_obj.rda&quot;</span>)</span></code></pre></div>
<p>The dataset looks like this (remember it has untreated and treated
samples for both OCT4 and BRG1).</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="rna-seq-eda.html#cb158-1" aria-hidden="true" tabindex="-1"></a>gse</span></code></pre></div>
<pre><code>## class: RangedSummarizedExperiment 
## dim: 53697 12 
## metadata(6): tximetaInfo quantInfo ... txomeInfo txdbInfo
## assays(3): counts abundance length
## rownames(53697): ENSMUSG00000000001.4 ENSMUSG00000000003.15 ... ENSMUSG00000117654.1
##   ENSMUSG00000117655.1
## rowData names(3): gene_id tx_ids SYMBOL
## colnames(12): OCT4-untrt-1 OCT4-untrt-2 ... BRG1-trt-2 BRG1-trt-3
## colData names(4): names line condition rep</code></pre>
<p>We will be interested in the gene set from the Gene Ontology project,
which describes maintenance of pluripotency. We can extra this from
the mouse organism data package with the following three lines of
code:</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="rna-seq-eda.html#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(AnnotationDbi)</span>
<span id="cb160-2"><a href="rna-seq-eda.html#cb160-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(org.Mm.eg.db)</span></code></pre></div>
<pre><code>## </code></pre>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="rna-seq-eda.html#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pluripotency</span></span>
<span id="cb162-2"><a href="rna-seq-eda.html#cb162-2" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">select</span>(org.Mm.eg.db, <span class="st">&quot;GO:0019827&quot;</span>, <span class="st">&quot;SYMBOL&quot;</span>, <span class="st">&quot;GO&quot;</span>)</span></code></pre></div>
<pre><code>## &#39;select()&#39; returned 1:many mapping between keys and columns</code></pre>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="rna-seq-eda.html#cb164-1" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> tab[<span class="sc">!</span><span class="fu">duplicated</span>(tab<span class="sc">$</span>SYMBOL),]</span>
<span id="cb164-2"><a href="rna-seq-eda.html#cb164-2" aria-hidden="true" tabindex="-1"></a>pluri <span class="ot">&lt;-</span> tab<span class="sc">$</span>SYMBOL</span></code></pre></div>
<p>Now we start with <em>tidybulk</em> code, comparing in turn to base R.
Loading <em>tidySummarizedExperiment</em> allows us to operate on the <code>gse</code>
object using familiar ‚Äútidy‚Äù verbs, thanks to an abstraction described
in the <a href="https://stemangiola.github.io/tidySummarizedExperiment/">tidySummarizedExperiment</a>
documentation.
We filter the samples that correspond to the OCT4 experiment, and then
modify the sample names. Samples are referred to with the special
<code>.sample</code> string, while features are referred to with <code>.feature</code>, so
here we create a new variable to plot the samples <code>sample_name</code>.</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="rna-seq-eda.html#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidySummarizedExperiment)</span>
<span id="cb165-2"><a href="rna-seq-eda.html#cb165-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb165-3"><a href="rna-seq-eda.html#cb165-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb165-4"><a href="rna-seq-eda.html#cb165-4" aria-hidden="true" tabindex="-1"></a>oct4 <span class="ot">&lt;-</span> gse <span class="sc">%&gt;%</span></span>
<span id="cb165-5"><a href="rna-seq-eda.html#cb165-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(line <span class="sc">==</span> <span class="st">&quot;OCT4&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb165-6"><a href="rna-seq-eda.html#cb165-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sample_name =</span> .sample <span class="sc">%&gt;%</span></span>
<span id="cb165-7"><a href="rna-seq-eda.html#cb165-7" aria-hidden="true" tabindex="-1"></a>           <span class="fu">str_remove</span>(<span class="st">&quot;OCT4-&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb165-8"><a href="rna-seq-eda.html#cb165-8" aria-hidden="true" tabindex="-1"></a>           <span class="fu">factor</span>(<span class="at">levels =</span> <span class="fu">unique</span>(.)),</span>
<span id="cb165-9"><a href="rna-seq-eda.html#cb165-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">condition =</span> condition <span class="sc">%&gt;%</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">&quot;untrt&quot;</span>,<span class="st">&quot;trt&quot;</span>)))</span></code></pre></div>
<p>Note, the third line in the <code>mutate</code> call uses the <code>unique</code> function
to set the levels: the consequence of this is that the <code>sample_name</code>
factor will have levels in the order in which they are present in the
current character vector and not alphabetical.</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="rna-seq-eda.html#cb166-1" aria-hidden="true" tabindex="-1"></a>oct4</span></code></pre></div>
<pre><code>## # A SummarizedExperiment-tibble abstraction: 322,182 √ó 18
## # [90mFeatures=53697 | Samples=6 | Assays=counts, abundance, length[0m
##    .feature    .sample counts abund‚Ä¶¬π length names line  condi‚Ä¶¬≤   rep sampl‚Ä¶¬≥ gene_id tx_ids SYMBOL
##    &lt;chr&gt;       &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;fct&gt;   &lt;int&gt; &lt;fct&gt;   &lt;chr&gt;   &lt;name&gt; &lt;chr&gt; 
##  1 ENSMUSG000‚Ä¶ OCT4-u‚Ä¶   2920 16.6     2953. SRX2‚Ä¶ OCT4  untrt       1 untrt-1 ENSMUS‚Ä¶ &lt;chr&gt;  Gnai3 
##  2 ENSMUSG000‚Ä¶ OCT4-u‚Ä¶      0  0        589. SRX2‚Ä¶ OCT4  untrt       1 untrt-1 ENSMUS‚Ä¶ &lt;chr&gt;  Pbsn  
##  3 ENSMUSG000‚Ä¶ OCT4-u‚Ä¶   1906 19.0     1688. SRX2‚Ä¶ OCT4  untrt       1 untrt-1 ENSMUS‚Ä¶ &lt;chr&gt;  Cdc45 
##  4 ENSMUSG000‚Ä¶ OCT4-u‚Ä¶   9044 74.8     2034. SRX2‚Ä¶ OCT4  untrt       1 untrt-1 ENSMUS‚Ä¶ &lt;chr&gt;  H19   
##  5 ENSMUSG000‚Ä¶ OCT4-u‚Ä¶    132  0.826   2688. SRX2‚Ä¶ OCT4  untrt       1 untrt-1 ENSMUS‚Ä¶ &lt;chr&gt;  Scml2 
##  6 ENSMUSG000‚Ä¶ OCT4-u‚Ä¶      0  0        943. SRX2‚Ä¶ OCT4  untrt       1 untrt-1 ENSMUS‚Ä¶ &lt;chr&gt;  Apoh  
##  7 ENSMUSG000‚Ä¶ OCT4-u‚Ä¶    444  1.84    4062. SRX2‚Ä¶ OCT4  untrt       1 untrt-1 ENSMUS‚Ä¶ &lt;chr&gt;  Narf  
##  8 ENSMUSG000‚Ä¶ OCT4-u‚Ä¶      8  0.0554  2430. SRX2‚Ä¶ OCT4  untrt       1 untrt-1 ENSMUS‚Ä¶ &lt;chr&gt;  Cav2  
##  9 ENSMUSG000‚Ä¶ OCT4-u‚Ä¶   2503 16.3     2588. SRX2‚Ä¶ OCT4  untrt       1 untrt-1 ENSMUS‚Ä¶ &lt;chr&gt;  Klf6  
## 10 ENSMUSG000‚Ä¶ OCT4-u‚Ä¶    610  7.58    1354. SRX2‚Ä¶ OCT4  untrt       1 untrt-1 ENSMUS‚Ä¶ &lt;chr&gt;  Scmh1 
## # ‚Ä¶ with 40 more rows, 5 more variables: seqnames &lt;fct&gt;, start &lt;int&gt;, end &lt;int&gt;, width &lt;int&gt;,
## #   strand &lt;fct&gt;, and abbreviated variable names ¬π‚Äãabundance, ¬≤‚Äãcondition, ¬≥‚Äãsample_name</code></pre>
<p><em>tidybulk</em> provides access to many steps in bulk analysis, including
filtering and count scaling. For details on what is happening behind
the scene, see the help, e.g.¬†<code>?keep_abundant</code> describes that it makes
use of <code>edgeR::filterByExpr</code>.</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="rna-seq-eda.html#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybulk)</span>
<span id="cb168-2"><a href="rna-seq-eda.html#cb168-2" aria-hidden="true" tabindex="-1"></a>oct4 <span class="ot">&lt;-</span> oct4 <span class="sc">%&gt;%</span></span>
<span id="cb168-3"><a href="rna-seq-eda.html#cb168-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">keep_abundant</span>(<span class="at">factor_of_interest =</span> condition) <span class="sc">%&gt;%</span></span>
<span id="cb168-4"><a href="rna-seq-eda.html#cb168-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_abundance</span>(<span class="at">method=</span><span class="st">&quot;RLE&quot;</span>) <span class="co"># DESeq2 scaling</span></span></code></pre></div>
<p>It is straightforward to pipe the data directly into plots:</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="rna-seq-eda.html#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb169-2"><a href="rna-seq-eda.html#cb169-2" aria-hidden="true" tabindex="-1"></a>oct4 <span class="sc">%&gt;%</span></span>
<span id="cb169-3"><a href="rna-seq-eda.html#cb169-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(sample_name, counts_scaled <span class="sc">+</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb169-4"><a href="rna-seq-eda.html#cb169-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb169-5"><a href="rna-seq-eda.html#cb169-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>()</span></code></pre></div>
<p><img src="rna-seq-eda_files/figure-html/tidy-boxplot-1.png" width="672" /></p>
<p>For comparing code, let‚Äôs pull out the genes that remain:</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="rna-seq-eda.html#cb170-1" aria-hidden="true" tabindex="-1"></a>gene_idx <span class="ot">&lt;-</span> oct4 <span class="sc">%&gt;%</span> <span class="fu">pivot_transcript</span>() <span class="sc">%&gt;%</span> <span class="fu">pull</span>(.feature)</span>
<span id="cb170-2"><a href="rna-seq-eda.html#cb170-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gene_idx)</span></code></pre></div>
<pre><code>## [1] &quot;ENSMUSG00000000001.4&quot;  &quot;ENSMUSG00000000028.15&quot; &quot;ENSMUSG00000000031.16&quot; &quot;ENSMUSG00000000037.16&quot;
## [5] &quot;ENSMUSG00000000056.7&quot;  &quot;ENSMUSG00000000058.6&quot;</code></pre>
<p>The equivalent code in DESeq2. Understanding this code requires
knowledge that <code>boxplot</code> plots columns of a matrix.</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="rna-seq-eda.html#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DESeq2)</span>
<span id="cb172-2"><a href="rna-seq-eda.html#cb172-2" aria-hidden="true" tabindex="-1"></a>gse_sub <span class="ot">&lt;-</span> gse[ gene_idx , gse<span class="sc">$</span>line <span class="sc">==</span> <span class="st">&quot;OCT4&quot;</span> ]</span>
<span id="cb172-3"><a href="rna-seq-eda.html#cb172-3" aria-hidden="true" tabindex="-1"></a>gse_sub<span class="sc">$</span>condition <span class="ot">&lt;-</span> <span class="fu">factor</span>(gse_sub<span class="sc">$</span>condition)</span>
<span id="cb172-4"><a href="rna-seq-eda.html#cb172-4" aria-hidden="true" tabindex="-1"></a>dds <span class="ot">&lt;-</span> gse_sub <span class="sc">%&gt;%</span></span>
<span id="cb172-5"><a href="rna-seq-eda.html#cb172-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">DESeqDataSet</span>(<span class="sc">~</span>condition) <span class="sc">%&gt;%</span></span>
<span id="cb172-6"><a href="rna-seq-eda.html#cb172-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">estimateSizeFactors</span>()</span></code></pre></div>
<pre><code>## using counts and average transcript lengths from tximeta</code></pre>
<pre><code>## using &#39;avgTxLength&#39; from assays(dds), correcting for library size</code></pre>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="rna-seq-eda.html#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(<span class="fu">counts</span>(dds, <span class="at">normalized=</span><span class="cn">TRUE</span>) <span class="sc">+</span> <span class="dv">1</span>, <span class="at">log=</span><span class="st">&quot;y&quot;</span>)</span></code></pre></div>
<p><img src="rna-seq-eda_files/figure-html/deseq-boxplot-1.png" width="672" /></p>
<p>We can also make more interesting plots. E.g. for the genes involved
in pluripotency, make a line plot, highlighting OCT4. In addition,
center the log counts for each gene (subtract the mean of log counts
across samples).</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="rna-seq-eda.html#cb176-1" aria-hidden="true" tabindex="-1"></a>oct4 <span class="sc">%&gt;%</span></span>
<span id="cb176-2"><a href="rna-seq-eda.html#cb176-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SYMBOL <span class="sc">%in%</span> pluri) <span class="sc">%&gt;%</span></span>
<span id="cb176-3"><a href="rna-seq-eda.html#cb176-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logcounts =</span> <span class="fu">log10</span>(counts_scaled <span class="sc">+</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb176-4"><a href="rna-seq-eda.html#cb176-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Oct4 =</span> <span class="fu">ifelse</span>(SYMBOL <span class="sc">==</span> <span class="st">&quot;Pou5f1&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;black&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb176-5"><a href="rna-seq-eda.html#cb176-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(.feature) <span class="sc">%&gt;%</span></span>
<span id="cb176-6"><a href="rna-seq-eda.html#cb176-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logcounts =</span> logcounts <span class="sc">-</span> <span class="fu">mean</span>(logcounts)) <span class="sc">%&gt;%</span></span>
<span id="cb176-7"><a href="rna-seq-eda.html#cb176-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb176-8"><a href="rna-seq-eda.html#cb176-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(sample_name, logcounts, <span class="at">group=</span>.feature, <span class="at">color=</span>Oct4)) <span class="sc">+</span></span>
<span id="cb176-9"><a href="rna-seq-eda.html#cb176-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb176-10"><a href="rna-seq-eda.html#cb176-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb176-11"><a href="rna-seq-eda.html#cb176-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_identity</span>()</span></code></pre></div>
<pre><code>## tidySummarizedExperiment says: A data frame is returned for independent data analysis.</code></pre>
<p><img src="rna-seq-eda_files/figure-html/tidy-lines-1.png" width="672" /></p>
<p>The equivalent code for base R requires defining more intermediate
variables and control flow code (the <code>for</code> loop). While there‚Äôs
nothing particularly right or wrong about the two choices, the above
prioritizes the operations in a way that is human readable. In some
cases, e.g.¬†performing linear algebra operations on matrices, base R
code may prove to be more efficient, which is a consideration for what
to use in package source code.</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="rna-seq-eda.html#cb178-1" aria-hidden="true" tabindex="-1"></a>pluri_idx <span class="ot">&lt;-</span> <span class="fu">mcols</span>(dds)<span class="sc">$</span>SYMBOL <span class="sc">%in%</span> pluri</span>
<span id="cb178-2"><a href="rna-seq-eda.html#cb178-2" aria-hidden="true" tabindex="-1"></a>mat <span class="ot">&lt;-</span> <span class="fu">log10</span>(<span class="fu">counts</span>(dds, <span class="at">normalized=</span><span class="cn">TRUE</span>)[pluri_idx,] <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb178-3"><a href="rna-seq-eda.html#cb178-3" aria-hidden="true" tabindex="-1"></a>mat <span class="ot">&lt;-</span> mat <span class="sc">-</span> <span class="fu">rowMeans</span>(mat)</span>
<span id="cb178-4"><a href="rna-seq-eda.html#cb178-4" aria-hidden="true" tabindex="-1"></a>hilite <span class="ot">&lt;-</span> <span class="fu">rownames</span>(dds)[<span class="fu">which</span>(<span class="fu">mcols</span>(dds)<span class="sc">$</span>SYMBOL <span class="sc">==</span> <span class="st">&quot;Pou5f1&quot;</span>)]</span>
<span id="cb178-5"><a href="rna-seq-eda.html#cb178-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mat[<span class="dv">1</span>,], <span class="at">type=</span><span class="st">&quot;n&quot;</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>), <span class="at">xlab=</span><span class="st">&quot;samples&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;logcounts&quot;</span>)</span>
<span id="cb178-6"><a href="rna-seq-eda.html#cb178-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(mat)) {</span>
<span id="cb178-7"><a href="rna-seq-eda.html#cb178-7" aria-hidden="true" tabindex="-1"></a>  col <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">rownames</span>(mat)[i] <span class="sc">==</span> hilite, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;black&quot;</span>)</span>
<span id="cb178-8"><a href="rna-seq-eda.html#cb178-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(mat[i,], <span class="at">type=</span><span class="st">&quot;b&quot;</span>, <span class="at">col=</span>col)</span>
<span id="cb178-9"><a href="rna-seq-eda.html#cb178-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="rna-seq-eda_files/figure-html/deseq-lines-1.png" width="672" /></p>
<p>We can test for differential expression with DESeq2:</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="rna-seq-eda.html#cb179-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> dds[gene_idx,] <span class="sc">%&gt;%</span></span>
<span id="cb179-2"><a href="rna-seq-eda.html#cb179-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">DESeq</span>(<span class="at">quiet=</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb179-3"><a href="rna-seq-eda.html#cb179-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">results</span>()</span></code></pre></div>
<p>Or equivalently with <em>tidybulk</em>:</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="rna-seq-eda.html#cb180-1" aria-hidden="true" tabindex="-1"></a>oct4 <span class="ot">&lt;-</span> oct4 <span class="sc">%&gt;%</span></span>
<span id="cb180-2"><a href="rna-seq-eda.html#cb180-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">test_differential_abundance</span>(<span class="sc">~</span>condition, <span class="at">method=</span><span class="st">&quot;deseq2&quot;</span>)</span></code></pre></div>
<pre><code>## =====================================
## tidybulk says: All testing methods use raw counts, irrespective of if scale_abundance
## or adjust_abundance have been calculated. Therefore, it is essential to add covariates
## such as batch effects (if applicable) in the formula.
## =====================================
## using counts and average transcript lengths from tximeta
## 
## estimating size factors
## 
## using &#39;avgTxLength&#39; from assays(dds), correcting for library size
## 
## estimating dispersions
## 
## gene-wise dispersion estimates
## 
## mean-dispersion relationship
## 
## final dispersion estimates
## 
## fitting model and testing
## 
## tidybulk says: to access the raw results (fitted GLM) do `attr(..., &quot;internals&quot;)$deseq2`
## This message is displayed once per session.</code></pre>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="rna-seq-eda.html#cb182-1" aria-hidden="true" tabindex="-1"></a>tidy_res <span class="ot">&lt;-</span> oct4 <span class="sc">%&gt;%</span></span>
<span id="cb182-2"><a href="rna-seq-eda.html#cb182-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_transcript</span>()</span></code></pre></div>
<p>Because we have filtered the two objects identically, we obtain the
same test results:</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="rna-seq-eda.html#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">rownames</span>(res), tidy_res<span class="sc">$</span>.feature)</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="rna-seq-eda.html#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="at">base_sig =</span> res<span class="sc">$</span>padj <span class="sc">&lt;</span> .<span class="dv">1</span>, <span class="at">tidy_sig =</span> tidy_res<span class="sc">$</span>padj <span class="sc">&lt;</span> .<span class="dv">1</span>)</span></code></pre></div>
<pre><code>##         tidy_sig
## base_sig FALSE  TRUE
##    FALSE 17965     0
##    TRUE      0  3512</code></pre>
<p>Finally, we build up to a more interesting plot. Suppose we now want
to split the genes involved in pluripotency by the DE result (the
significance and LFC), and then add the gene symbol to the side.</p>
<p>We begin by building the dataset:</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="rna-seq-eda.html#cb187-1" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> oct4 <span class="sc">%&gt;%</span></span>
<span id="cb187-2"><a href="rna-seq-eda.html#cb187-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SYMBOL <span class="sc">%in%</span> pluri) <span class="sc">%&gt;%</span></span>
<span id="cb187-3"><a href="rna-seq-eda.html#cb187-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logcounts =</span> <span class="fu">log10</span>(counts_scaled <span class="sc">+</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb187-4"><a href="rna-seq-eda.html#cb187-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Oct4 =</span> <span class="fu">ifelse</span>(SYMBOL <span class="sc">==</span> <span class="st">&quot;Pou5f1&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;black&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb187-5"><a href="rna-seq-eda.html#cb187-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(.feature) <span class="sc">%&gt;%</span></span>
<span id="cb187-6"><a href="rna-seq-eda.html#cb187-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">logcounts =</span> logcounts <span class="sc">-</span> <span class="fu">mean</span>(logcounts)) <span class="sc">%&gt;%</span></span>
<span id="cb187-7"><a href="rna-seq-eda.html#cb187-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb187-8"><a href="rna-seq-eda.html#cb187-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gene_type =</span> <span class="fu">case_when</span>(</span>
<span id="cb187-9"><a href="rna-seq-eda.html#cb187-9" aria-hidden="true" tabindex="-1"></a>           padj <span class="sc">&lt;</span> .<span class="dv">1</span> <span class="sc">&amp;</span> log2FoldChange <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;up&quot;</span>,</span>
<span id="cb187-10"><a href="rna-seq-eda.html#cb187-10" aria-hidden="true" tabindex="-1"></a>           padj <span class="sc">&lt;</span> .<span class="dv">1</span> <span class="sc">&amp;</span> log2FoldChange <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;down&quot;</span>,</span>
<span id="cb187-11"><a href="rna-seq-eda.html#cb187-11" aria-hidden="true" tabindex="-1"></a>           <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;null&quot;</span>))</span></code></pre></div>
<pre><code>## tidySummarizedExperiment says: A data frame is returned for independent data analysis.</code></pre>
<p>Now we repeat the code from before, but now faceting by
<code>gene_type</code>. Furthermore, we use <code>geom_text_repel</code> to add labels to
the right side.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="rna-seq-eda.html#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb189-2"><a href="rna-seq-eda.html#cb189-2" aria-hidden="true" tabindex="-1"></a>plot_data <span class="sc">%&gt;%</span></span>
<span id="cb189-3"><a href="rna-seq-eda.html#cb189-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(gene_type <span class="sc">!=</span> <span class="st">&quot;null&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb189-4"><a href="rna-seq-eda.html#cb189-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(sample_name, logcounts, <span class="at">group=</span>.feature, <span class="at">color=</span>Oct4)) <span class="sc">+</span></span>
<span id="cb189-5"><a href="rna-seq-eda.html#cb189-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb189-6"><a href="rna-seq-eda.html#cb189-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb189-7"><a href="rna-seq-eda.html#cb189-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="at">data=</span>plot_data <span class="sc">%&gt;%</span></span>
<span id="cb189-8"><a href="rna-seq-eda.html#cb189-8" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">filter</span>(sample_name <span class="sc">==</span> <span class="st">&quot;trt-3&quot;</span>, gene_type <span class="sc">!=</span> <span class="st">&quot;null&quot;</span>),</span>
<span id="cb189-9"><a href="rna-seq-eda.html#cb189-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(sample_name, logcounts, <span class="at">label=</span>SYMBOL), <span class="at">nudge_x=</span>.<span class="dv">5</span>, <span class="at">seed=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb189-10"><a href="rna-seq-eda.html#cb189-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_identity</span>() <span class="sc">+</span></span>
<span id="cb189-11"><a href="rna-seq-eda.html#cb189-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>gene_type) <span class="sc">+</span></span>
<span id="cb189-12"><a href="rna-seq-eda.html#cb189-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">add =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb189-13"><a href="rna-seq-eda.html#cb189-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;sample&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: ggrepel: 3 unlabeled data points (too many overlaps). Consider increasing max.overlaps</code></pre>
<p><img src="rna-seq-eda_files/figure-html/tidy-lines-faceted-1.png" width="672" /></p>

</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-king_klose" class="csl-entry">
King, Hamish W, and Robert J Klose. 2017. <span>‚ÄúThe Pioneer Factor Oct4 Requires the Chromatin Remodeller Brg1 to Support Gene Regulatory Element Function in Mouse Embryonic Stem Cells.‚Äù</span> Edited by Irwin Davidson. <em>eLife</em> 6 (March): e22631. <a href="https://doi.org/10.7554/eLife.22631">https://doi.org/10.7554/eLife.22631</a>.
</div>
<div id="ref-tidybulk" class="csl-entry">
Mangiola, Stefano, Ramyar Molania, Ruining Dong, Maria A. Doyle, and Anthony T. Papenfuss. 2021. <span>‚ÄúTidybulk: An r Tidy Framework for Modular Transcriptomic Data Analysis.‚Äù</span> <em>Genome Biology</em> 22 (1): 42. <a href="https://doi.org/10.1186/s13059-020-02233-7">https://doi.org/10.1186/s13059-020-02233-7</a>.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="gene-plots.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="many-models.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
